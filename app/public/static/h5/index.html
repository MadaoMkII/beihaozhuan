<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">

    <meta name="mobileoptimized" content="0"/>

    <meta name="viewport" content="width=device-width, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

    <meta name="apple-mobile-web-app-capable" content="yes">
    <link href="css/wm.css?v=201412030431" rel=stylesheet> <!---->

    <meta name="keywords" content=""/>

    <title></title>

    <style>

        #layout {

            position: absolute;

            left: 0;

            right: 0;

            top: 0;

            bottom: 0;

            overflow: hidden;

            background: black;

        }



        .page, .page-init {

            position: absolute;

            left: 0;

            right: 0;

            top: 0;

            bottom: 0;

            overflow: hidden;

        }



        .page-init {

            z-index: 10;

        }



        .lock {

            pointer-events: none;

        }



        .hide {

            display: none;

        }

    </style>

</head>

<body>

<div class="page-loading">

  <ul class="border">

    <li></li>

    <li></li>

    <li></li>

    <li></li>

  </ul>

</div>
<div id="layout">
<!--第一页-->
    <div class="page page-0">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/homeBg.png" class="back-img">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/homeCenter.png" class="page-logo">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/name.png" class="page-title">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/wedding.png" class="page0-title">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/marry.png" class="page0-info">

        <div class="arrow"></div>

    </div>
<!-- 第二页-->
    <div class="page page-1">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/bg.png" class="back-img">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/border.png" class="page-border">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/title.png" class="page-title">
        <div class="nameLine">
          新郎：李经伟 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;新娘：郭惠
        </div>
        <div class="phoneLine">
          <div class="smItem">
            <div class="phoneIcon"><img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/phone.png"></div>
            <div class="phoneNum"><a href="tel:15620304097">15620304097</a></div>
          </div>
          <div class="smItem rightSmItem">
            <div class="phoneIcon"><img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/phone.png"></div>
            <div class="phoneNum"><a href="tel:18222133066">18222133066</a></div>
          </div>
        </div>
<!--        <div class="welcome">诚邀您见证我们的婚礼</div>-->
        <div class="timeCon">
          <div class="timeTitle">【 时间 】</div>
          <div class="time">2019年11月12日15:00</div>
        </div>
        <div class="timeCon addressCon">
          <div class="timeTitle">【 地点 】</div>
          <div class="time">天津市河东区大直沽八号路486号<br>天津万达文华酒店</div>
        </div>
        <div class="mapCon" onclick="showMap()">
          <div class="mapApiCon" style="width: 100%;height: 100%;position: absolute" id="mapApiCon">
          </div>
        </div>

        <div class="arrow"></div>

    </div>

    <div class="page page-2">
      <div id="showCode">
        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/bg.png" class="back-img">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/border.png" class="page-border">

        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/ticket.png" class="page-title">
        <div class="visitors">
          尊敬的<span id="campOne"></span>的<span class="nickName" id="nickNameOne"></span>
        </div>
        <div class="welcome">请您于当日扫码入场</div>
        <div class="codeCon">
          <div class="qrcodeCon" id="qrcode"></div>
        </div>
      </div>
      <div id="showSeat">
        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/bg.png" class="back-img">
        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/border.png" class="page-border">
        <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/seatTitle.png" class="page-title">
        <div class="visitors">
          尊敬的<span id="campTwo"></span>的<span class="nickName" id="nickNameTwo"></span>
        </div>
        <div class="visitors tableNumCon">
          您的桌号为：<span id="tableNum"></span>
        </div>
        <div class="tableCon">
          <div class="tableCenter"></div>
        </div>
        <div class="inTips">入口</div>
      </div>
      <div class="arrow"></div>
    </div>



    <div class="page page-3">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/companyBg.png" class="back-img">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/1.png" class="imgConOne">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/2.png" class="imgConTwo">
      <div class="arrow"></div>
    </div>
    <div class="page page-4">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/companyBg.png" class="back-img">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/3.png" class="imgConThree">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/4.png" class="imgConFour">
      <div class="arrow"></div>
    </div>
    <div class="page page-5">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/companyBg.png" class="back-img">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/5.png" class="imgConFive">
      <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/6.png" class="imgConSix">
      <div class="arrow"></div>
    </div>
  <div class="page page-6">
    <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/companyBg.png" class="back-img">
    <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/7.png" class="imgConSeven">
    <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/8.png" class="imgConEight">
    <img src="https://jswd001.oss-cn-beijing.aliyuncs.com/qingjianbao/wxCode.png" class="imgConCode">
    <div class="welcome phone">联系我们&nbsp;&nbsp;&nbsp;15620304097</div>
    <div class="arrow"></div>
  </div>
</div>

<div id="template">

    <!--地图页-->

    <div data-template-id="page-map" class="page-map">

        <div class="c-title-bar">

            <div class="c-icon c-back" style="cursor: pointer;"></div>

            <div class="c-line"></div>

            <div class="c-caption">地图</div>

        </div>

        <div id="container"></div>

    </div>

</div>
<script src="http://res.wx.qq.com/open/js/jweixin-1.4.0.js"></script>
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script type="text/javascript" src="https://webapi.amap.com/maps?v=1.4.15&key=b14f98cf2431bfa278741f1574889837"></script>
<script src="js/zMobile.js?v=20141202042"></script>

<script src="js/zScrollPanel.js?v=20141202042"></script>

<script src="js/wmLib.js?v=20141202042"></script>

<script src="js/sphere.js?v=20141203042"></script>

<script src="js/wm.js?v=2014120404121"></script>

<script src="js/maps?v=1.3&key=e171bb358bfbbb0a09489dc6464496a8"></script>
<script src="js/qrcodejs/qrcode.min.js"></script>
<script src="https://cdn.bootcss.com/socket.io/2.2.0/socket.io.js"></script>
<script>
  var uuid = parent.getUUid();
  console.log('uuid',uuid);
  var styleList = [
    {'style':'top:10%;left:20%;','num':'A'},
    {'style':'top:25%;left:10%;','num':'B'},
    {'style':'top:40%;left:20%;','num':'C'},
    {'style':'top:55%;left:10%;','num':'D'},
    {'style':'top:70%;left:20%;','num':'E'},
    {'style':'top:85%;left:5%;','num':'F'},
    {'style':'top:10%;left:60%;','num':'G'},
    {'style':'top:25%;left:70%;','num':'H'},
    {'style':'top:40%;left:60%;','num':'I'},
    {'style':'top:55%;left:70%;','num':'J'},
    {'style':'top:70%;left:60%;','num':'K'},
    {'style':'top:86%;left:60%;','num':'L'},
    {'style':'top:86%;left:80%;','num':'M'},
  ];
  $(function() {// 初始化内容
    getWxInfo();  //微信sdk授权
    getInfo(); // 获取初始化数据
    var marker, map = new AMap.Map("mapApiCon", {
      resizeEnable: true,
      center: [117.238155,39.10485],
      zoom: 14
    });
    map.on('complete', function() {
      addMarker();
    });
    // 实例化点标记
    function addMarker() {
      marker = new AMap.Marker({
        icon: "//a.amap.com/jsapi_demos/static/demo-center/icons/poi-marker-default.png",
        position: [117.238155,39.10485],
        offset: new AMap.Pixel(-13, -30)
      });
      marker.setMap(map);
    }
  });
  //微信sdk授权
  function getWxInfo() {
    let a = 'http://www.mystery-vr.com/?uuid='+uuid;
    // let a = window.location.href;
    let url = encodeURIComponent(a);
    $.ajax({
      type:"GET",
      url:"http://www.mystery-vr.com/wechat/getSignature?url="+url,
      // dataType:"json",
      success:function(res){
        // if(res.code == 0){
          wx.config({
            debug : false, //开启调试模式,调用的所有api的返回值会在客户端alert出来，若要查看传入的参数，可以在pc端打开，参数信息会通过log打出，仅在pc端时才会打印。
            appId : res.data.appID, //必填，公众号的唯一标识
            timestamp : res.data.timestamp, //必填，生成签名的时间戳
            nonceStr : res.data.noncestr, //必填，生成签名的随机串
            signature : res.data.signature,//必填，签名，见附录1
            jsApiList : [ 'openLocation','getLocation']//必填，需要使用的JS接口列表，所有JS接口列表见附录2
          });
        // }
      },
      error:function () {
      }
    });
  }
  function getInfo() {
    $.ajax({
      type:"GET",
      url:"http://www.mystery-vr.com/getInitialData?uuid="+uuid,
      dataType:"json",
      success:function(res){
        if(res.code == 0){
          showInfo(res.data)
        }
      }
    });
  }
  //回显获取到的数据
  function showInfo(data){
    var camp = data.guest.camp === '男方' ? '李经纬' : '郭惠';
    var ninckName = data.guest.title + data.guest.name;
    var numberOFTable = data.guest.numberOFTable;
    var attended = data.guest.attended;
    $('#campOne').html(camp);
    $('#campTwo').html(camp);
    $('#nickNameOne').html(ninckName);
    $('#nickNameTwo').html(ninckName);

    if(attended === 'true'){
      initSeat(numberOFTable);   //高亮座位号
      $('#showCode').hide();
      $('#showSeat').show();
    }else {
      getQrCode();  //获取二维码
      $('#showCode').show();
      $('#showSeat').hide();
    }
  }
  function initSeat(numberOFTable) {

    $('#tableNum').html(numberOFTable);
    for (var i=0;i<styleList.length;i++){
      let html = '<div id="seat'+ i +'" class="seatCon" style="'+ styleList[i].style+'">'+ styleList[i].num +'</div>';
      $('.tableCon').append(html);
      if(styleList[i].num === numberOFTable){
        $('#seat'+i).addClass('lightSeatCon');
      }
    }
  }
  //显示二维码
  function getQrCode() {
    var qrcode = new QRCode("qrcode",{
      width: 128,
      height: 128,
    });
    const socket = io('/', {
      // 实际使用中可以在这里传递参数
      query: {
        room: 'demo',
        userId: `client_${Math.random()}`,
      },
      transports: ['websocket']
    });
    //var socket = io.connect(`http://www.mystery-vr.com`);
    window.socket = socket;

    socket.on('connect', () => {
      const id = socket.id;
      console.log('#connect,', id, socket);
      let link = `http://www.mystery-vr.com/callQrcode?connectID=${id}&uuid=${uuid}`;
      console.log(link)
      qrcode.makeCode(link);
      // 监听自身 id 以实现 p2p 通讯
      // socket.on(id, msg => {
      //   log('#receive,', msg);
      // });
    });

    socket.on('scanResult', msg => {
      if(msg === 'hide'){
        $('#showCode').hide();
        $('#showSeat').show();
      }
    });
  }
  //点击地图调用微信地图
  function showMap() {
    // let a = parseFloat('22.545538');
    // let b = parseFloat('114.054565');
    // wx.getLocation({
    //   type: 'gcj02', // 默认为wgs84的gps坐标，如果要返回直接给openLocation用的火星坐标，可传入'gcj02'
    //   success: function (res) {
    //     console.log('res',res);
    //     wx.openLocation({
    //       latitude: parseFloat(res.latitude), // 纬度，浮点数，范围为90 ~ -90。如果是动态获取的数据，使用parseFloat()处理数据
    //       longitude: parseFloat(res.longitude), // 经度，浮点数，范围为180 ~ -180。如果是动态获取的数据，使用parseFloat()处理数据；
    //       name: '天津万达文华酒店', // 位置名
    //       address: '天津市河东区大直沽八号路486号', // 地址详情说明
    //     });
    //   },
    //   fail:function (error) {
    //     console.log('error',error);
    //   }
    // });
    window.location.href='https://uri.amap.com/marker?position=117.238155,39.10485&name=天津万达文华酒店'
  }
</script>
</body>

</html>
